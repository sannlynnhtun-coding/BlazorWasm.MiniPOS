@page "/best-product-report"

<div class="space-y-8 animate-fade-in max-w-[1200px] mx-auto pb-8">
    <div>
        <h2 class="text-3xl font-bold text-foreground tracking-tight">Best Sellers</h2>
        <p class="text-sm text-muted-foreground mt-2 font-medium">Top selling products by volume.</p>
    </div>

    <div class="bg-card rounded-lg border border-border overflow-hidden shadow-sm animate-slide-up">
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm whitespace-nowrap">
                <thead>
                    <tr class="bg-muted/50 border-b border-border">
                        <th class="px-8 py-4 font-bold text-muted-foreground uppercase tracking-widest text-[10px]">Product Catalog</th>
                        <th class="px-8 py-4 font-bold text-muted-foreground uppercase tracking-widest text-[10px] text-right">Units Sold</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border">
                    @if (_lstBestProductReport != null)
                    {
                        @foreach (var item in _lstBestProductReport)
                        {
                            <tr class="hover:bg-accent/50 transition-colors animate-fade-in group">
                                <td class="px-8 py-6">
                                    <div class="font-bold text-foreground text-base">@item.ProductName</div>
                                </td>
                                <td class="px-8 py-6 text-right">
                                    <span class="inline-flex items-center px-4 py-1 rounded-md bg-primary text-primary-foreground font-bold text-xs shadow-sm">
                                        @item.ProductQuantity
                                    </span>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="2" class="px-8 py-20 text-center">
                                <div class="w-8 h-8 border-4 border-primary/20 border-t-primary rounded-full animate-spin mx-auto mb-4"></div>
                                <p class="text-xs font-bold text-muted-foreground uppercase tracking-widest">Aggregating Sales Data</p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@code {
    private List<BestProductReportModel>? _lstBestProductReport;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _lstBestProductReport = await db.BestProductReport();
            StateHasChanged();
        }
    }
}