<style>
    /* Legacy styles removed - using global premium design system */
</style>

@if (Type == EnumFormType.List)
{
    <div class="space-y-12 animate-fade-in max-w-[1400px] mx-auto">
        <div class="card-premium shadow-premium-3 !p-0 overflow-hidden border-none bg-white">
            <div class="overflow-x-auto">
                <table class="table-premium">
                    <thead>
                        <tr class="bg-gray-50/50">
                            <th class="py-6 px-10">Voucher Reference</th>
                            <th class="py-6 px-10">Economic Value</th>
                            <th class="py-6 px-10">Execution Timestamp</th>
                            <th class="py-6 px-10 text-right">Verification</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-50">
                        @foreach (var item in Model.lstSaleReport)
                        {
                            DateTime = item.sale_date;
                            <tr class="hover:bg-gray-50/80 transition-premium group">
                                <td class="py-6 px-10">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-white border border-gray-100 text-gray-400 rounded-xl flex items-center justify-center mr-5 shadow-sm group-hover:border-premium-orange-200 group-hover:text-premium-orange-500 transition-all font-black text-xs">
                                            #V
                                        </div>
                                        <div class="font-black text-gray-900 text-base tracking-tight">@item.sale_voucher_no</div>
                                    </div>
                                </td>
                                <td class="py-6 px-10 font-black text-premium-orange-600 text-lg tracking-tighter">
                                    @item.sale_total_amount.ToString("N0") <small class="text-[10px] opacity-80 font-bold">MMK</small>
                                </td>
                                <td class="py-6 px-10 font-black text-gray-400 text-xs uppercase tracking-widest">
                                    @item.sale_date.ToString("MMM dd, yyyy â€¢ HH:mm")
                                </td>
                                <td class="py-6 px-10 text-right">
                                    <button @onclick="() => Deatil(item)" class="btn-premium !py-2.5 !px-5 text-[10px] uppercase tracking-[0.15em] font-black group-hover:scale-105 transition-all">
                                        View Details
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            
            @if (Model != null)
            {
                <div class="p-10 border-t-2 border-gray-50 flex justify-center bg-white shadow-inner">
                    <div class="flex items-center space-x-3">
                        @{
                            var curPage = Model.CurrentPageNo;
                            var totalP = Model.TotalPageNo;
                        }

                        <button @onclick="() => PageChanged(curPage - 1)" 
                                disabled="@(curPage == 1)"
                                class="icon-btn-premium w-12 h-12 disabled:opacity-30 disabled:cursor-not-allowed">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M15 19l-7-7 7-7"/></svg>
                        </button>

                        @for (int i = 1; i <= totalP; i++)
                        {
                            var p = i;
                            <button @onclick="() => PageChanged(p)"
                                    class="w-12 h-12 rounded-2xl border-2 font-black text-sm transition-all @(curPage == p ? "bg-premium-orange-500 border-premium-orange-600 text-white shadow-premium-orange-sm" : "border-gray-100 text-gray-400 hover:border-premium-orange-300 hover:text-premium-orange-600 hover:bg-premium-orange-50/30")">
                                @p
                            </button>
                        }

                        <button @onclick="() => PageChanged(curPage + 1)" 
                                disabled="@(curPage == totalP)"
                                class="icon-btn-premium w-12 h-12 disabled:opacity-30 disabled:cursor-not-allowed">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>
}
else if (Type == EnumFormType.Report)
{
    <div class="max-w-2xl mx-auto space-y-10 animate-fade-in py-10">
        <div class="flex items-center justify-between mb-2">
            <button @onclick="Back" class="icon-btn-premium !w-14 !h-14 shadow-premium-2 group hover:scale-110 transition-all">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M15 19l-7-7 7-7"/></svg>
            </button>
            <div class="text-right">
                <h3 class="text-lg font-black text-gray-900 tracking-tight">Voucher Inspection</h3>
                <p class="text-[10px] text-premium-orange-500 font-bold uppercase tracking-widest mt-1">Live Audit Mode</p>
            </div>
        </div>

        <div class="card-premium shadow-premium-4 !p-0 bg-white border-none overflow-hidden relative">
            <div class="h-3 bg-gradient-to-r from-premium-orange-400 to-premium-orange-600"></div>
            <div class="p-12 space-y-12">
                <div class="flex flex-col items-center text-center space-y-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-premium-orange-50 to-premium-orange-100/50 text-premium-orange-600 rounded-[2rem] flex items-center justify-center shadow-inner rotate-3">
                         <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                    </div>
                    <div>
                        <h4 class="text-2xl font-outfit font-black text-gray-900 tracking-tight">Premium<span class="text-premium-orange-500">POS</span> Elite</h4>
                        <p class="text-[10px] text-gray-400 font-black uppercase tracking-[0.3em] mt-2">Analytical Voucher Summary</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-8 py-8 border-y-2 border-gray-50 border-dashed">
                    <div class="space-y-1">
                        <span class="text-[9px] font-black text-gray-400 uppercase tracking-widest">Metadata Hash</span>
                        <p class="text-sm font-black text-gray-900">#TRX-@DateTime.Ticks.ToString().Substring(0, 8)</p>
                    </div>
                    <div class="space-y-1 text-right">
                        <span class="text-[9px] font-black text-gray-400 uppercase tracking-widest">Verification Node</span>
                        <p class="text-sm font-black text-gray-900">@DateTime.ToString("MMM dd, yyyy")</p>
                    </div>
                </div>

                <div class="space-y-6">
                    @foreach (var item in Detail)
                    {
                        <div class="flex justify-between items-start group">
                            <div class="space-y-1">
                                <p class="text-sm font-black text-gray-900 group-hover:text-premium-orange-600 transition-colors">@item.product_name</p>
                                <p class="text-[10px] text-gray-400 font-bold">@item.product_qty x @item.product_price.ToString("N0")</p>
                            </div>
                            <div class="text-right font-black text-gray-900 text-sm">
                                @((item.product_price * item.product_qty).ToString("N0")) <small class="text-[9px] opacity-40">MMK</small>
                            </div>
                        </div>
                    }
                </div>

                <div class="pt-10 space-y-5 border-t-2 border-gray-50 border-dashed">
                    <div class="p-8 bg-premium-orange-50 rounded-[2.5rem] flex justify-between items-center text-premium-orange-900 overflow-hidden relative">
                         <div class="absolute -right-4 -bottom-4 w-24 h-24 bg-premium-orange-100/50 rounded-full blur-2xl"></div>
                         <div class="flex flex-col relative z-10">
                            <span class="text-[10px] font-black uppercase tracking-[0.2em] opacity-60">Collective Total</span>
                            <span class="text-3xl font-outfit font-black tracking-tighter">@(Detail.Select(x => x.product_qty * x.product_price).Sum().ToString("N0"))</span>
                         </div>
                    </div>
                </div>
            </div>
            <div class="absolute top-1/2 -left-3 w-6 h-6 bg-gray-50 rounded-full -translate-y-1/2 shadow-inner"></div>
            <div class="absolute top-1/2 -right-3 w-6 h-6 bg-gray-50 rounded-full -translate-y-1/2 shadow-inner"></div>
        </div>
    </div>
}

@code {

    [Parameter]
    public SaleReportResponseDataModel? Model { get; set; }

    private List<SaleVoucherDetailDataModel>? Detail { get; set; } = new();
    private EnumFormType Type { get; set; } = EnumFormType.List;
    private DateTime DateTime { get; set; }

    [Parameter]
    public EventCallback<SaleVoucherHeadDataModel> OnDetailClick { get; set; }

    [Parameter]
    public EventCallback<SaleVoucherHeadDataModel> OnBackClick { get; set; }

    async Task PageChanged(int pageNo)
    {
        var result = await db.SaleReportPagination(pageNo, 5, DateTime);
        Model = result;
    }

    async Task Deatil(SaleVoucherHeadDataModel data)
    {
        Type = EnumFormType.Report;
        Detail = await db.GetVoucherDetail(data.sale_voucher_head_id);
        await OnDetailClick.InvokeAsync(data);
    }

    async Task Back()
    {
        Type = EnumFormType.List;
        await OnBackClick.InvokeAsync();
    }

}