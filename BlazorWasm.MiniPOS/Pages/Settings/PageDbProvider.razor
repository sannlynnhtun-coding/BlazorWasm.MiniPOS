@page "/settings/db-provider"

<div class="max-w-4xl mx-auto py-8 animate-fade-in">
    <div class="mb-8">
        <h2 class="text-3xl font-outfit font-bold text-gray-900 tracking-tight">Storage Settings</h2>
        <p class="text-gray-600 mt-2 font-medium">Select your preferred database provider for local data persistence.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- IndexedDB -->
        <div class="card-premium p-6 cursor-pointer transition-premium border-2 shadow-premium-2 @(StorageService.CurrentType == StorageType.IndexedDb ? "!border-premium-orange-500 ring-4 ring-premium-orange-500/10 !shadow-premium-orange" : "border-transparent hover:border-gray-200 hover:shadow-premium-3")"
             @onclick="() => ChangeStorage(StorageType.IndexedDb)">
            <div class="flex items-center justify-between mb-4">
                <div class="w-14 h-14 bg-gradient-to-br from-premium-orange-100 to-premium-orange-200 rounded-xl flex items-center justify-center text-premium-orange-700 shadow-premium-1">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3zM4 11h16M4 15h16" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.IndexedDb)
                {
                    <span class="badge-premium !bg-gradient-to-br !from-premium-orange-500 !to-premium-orange-600 !text-white !shadow-premium-orange">Active</span>
                }
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2 tracking-tight">IndexedDB</h3>
            <p class="text-gray-600 text-sm leading-relaxed font-medium">Recommended for larger datasets. Persists data locally in the browser's database, even after closing the tab.</p>
        </div>

        <!-- Session Storage -->
        <div class="card-premium p-6 cursor-pointer transition-premium border-2 shadow-premium-2 @(StorageService.CurrentType == StorageType.SessionStorage ? "!border-premium-orange-500 ring-4 ring-premium-orange-500/10 !shadow-premium-orange" : "border-transparent hover:border-gray-200 hover:shadow-premium-3")"
             @onclick="() => ChangeStorage(StorageType.SessionStorage)">
            <div class="flex items-center justify-between mb-4">
                <div class="w-14 h-14 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center text-gray-700 shadow-premium-1">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.SessionStorage)
                {
                    <span class="badge-premium !bg-gradient-to-br !from-premium-orange-500 !to-premium-orange-600 !text-white !shadow-premium-orange">Active</span>
                }
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2 tracking-tight">Session Storage</h3>
            <p class="text-gray-600 text-sm leading-relaxed font-medium">Temporary storage that lasts only until the browser tab is closed. Ideal for quick demos or ephemeral data.</p>
        </div>

        <!-- Local Storage -->
        <div class="card-premium p-6 cursor-pointer transition-premium border-2 shadow-premium-2 @(StorageService.CurrentType == StorageType.LocalStorage ? "!border-premium-orange-500 ring-4 ring-premium-orange-500/10 !shadow-premium-orange" : "border-transparent hover:border-gray-200 hover:shadow-premium-3")"
             @onclick="() => ChangeStorage(StorageType.LocalStorage)">
            <div class="flex items-center justify-between mb-4">
                <div class="w-14 h-14 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center text-gray-700 shadow-premium-1">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.LocalStorage)
                {
                    <span class="badge-premium !bg-gradient-to-br !from-premium-orange-500 !to-premium-orange-600 !text-white !shadow-premium-orange">Active</span>
                }
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2 tracking-tight">Local Storage</h3>
            <p class="text-gray-600 text-sm leading-relaxed font-medium">Browser-level persistence. Similar to IndexedDB but with a smaller capacity limit (usually around 5-10MB).</p>
        </div>
    </div>

    @if (isUpdating)
    {
        <div class="mt-8 card-premium p-5 !bg-gradient-to-br !from-premium-orange-50 !to-orange-50 border-2 !border-premium-orange-200 flex items-center space-x-4 animate-fade-in shadow-premium-orange">
            <div class="w-6 h-6 border-2 border-premium-orange-500 border-t-transparent rounded-full animate-spin"></div>
            <span class="text-premium-orange-900 font-bold font-outfit">Applying changes and reinitializing database...</span>
        </div>
    }
</div>

@code {
    private bool isUpdating = false;

    private async Task ChangeStorage(StorageType type)
    {
        if (StorageService.CurrentType == type) return;

        isUpdating = true;
        StateHasChanged();
        
        await Task.Delay(800); // UI feel
        StorageService.SetStorageType(type);
        
        // Force a page reload to reset state
        nav.NavigateTo(nav.Uri, forceLoad: true);
    }
}
