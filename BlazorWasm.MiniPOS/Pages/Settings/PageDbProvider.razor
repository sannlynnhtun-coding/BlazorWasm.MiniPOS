@page "/settings/db-provider"

<div class="max-w-[1200px] mx-auto space-y-8 animate-fade-in pb-12">
    <div>
        <h2 class="text-3xl font-bold text-foreground tracking-tight">Core Storage</h2>
        <p class="text-sm text-muted-foreground mt-2 font-medium">Configure primary data persistence engine for local operations.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- IndexedDB -->
        <div class="bg-card p-8 rounded-lg border-2 transition-all cursor-pointer @(StorageService.CurrentType == StorageType.IndexedDb ? "border-primary shadow-md ring-4 ring-primary/5" : "border-border hover:border-primary/50 hover:shadow-sm")"
             @onclick="() => ChangeStorage(StorageType.IndexedDb)">
            <div class="flex items-center justify-between mb-8">
                <div class="w-12 h-12 rounded-lg flex items-center justify-center transition-all @(StorageService.CurrentType == StorageType.IndexedDb ? "bg-primary text-primary-foreground shadow-sm" : "bg-muted text-muted-foreground")">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3zM4 11h16M4 15h16" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.IndexedDb)
                {
                    <span class="inline-flex items-center px-2 py-1 rounded bg-primary/10 text-primary text-[10px] font-bold uppercase tracking-widest border border-primary/20">Active</span>
                }
            </div>
            <h3 class="text-lg font-bold text-foreground mb-2">IndexedDB</h3>
            <p class="text-muted-foreground text-sm font-medium leading-relaxed">Industrial-grade local storage. Optimized for high-volume datasets and structured transaction logging.</p>
        </div>

        <!-- Session Storage -->
        <div class="bg-card p-8 rounded-lg border-2 transition-all cursor-pointer @(StorageService.CurrentType == StorageType.SessionStorage ? "border-primary shadow-md ring-4 ring-primary/5" : "border-border hover:border-primary/50 hover:shadow-sm")"
             @onclick="() => ChangeStorage(StorageType.SessionStorage)">
            <div class="flex items-center justify-between mb-8">
                <div class="w-12 h-12 rounded-lg flex items-center justify-center transition-all @(StorageService.CurrentType == StorageType.SessionStorage ? "bg-primary text-primary-foreground shadow-sm" : "bg-muted text-muted-foreground")">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.SessionStorage)
                {
                    <span class="inline-flex items-center px-2 py-1 rounded bg-primary/10 text-primary text-[10px] font-bold uppercase tracking-widest border border-primary/20">Active</span>
                }
            </div>
            <h3 class="text-lg font-bold text-foreground mb-2">Volatile Memory</h3>
            <p class="text-muted-foreground text-sm font-medium leading-relaxed">Temporary operational state. Data is cleared instantly upon session termination or tab closure.</p>
        </div>

        <!-- Local Storage -->
        <div class="bg-card p-8 rounded-lg border-2 transition-all cursor-pointer @(StorageService.CurrentType == StorageType.LocalStorage ? "border-primary shadow-md ring-4 ring-primary/5" : "border-border hover:border-primary/50 hover:shadow-sm")"
             @onclick="() => ChangeStorage(StorageType.LocalStorage)">
            <div class="flex items-center justify-between mb-8">
                <div class="w-12 h-12 rounded-lg flex items-center justify-center transition-all @(StorageService.CurrentType == StorageType.LocalStorage ? "bg-primary text-primary-foreground shadow-sm" : "bg-muted text-muted-foreground")">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.LocalStorage)
                {
                    <span class="inline-flex items-center px-2 py-1 rounded bg-primary/10 text-primary text-[10px] font-bold uppercase tracking-widest border border-primary/20">Active</span>
                }
            </div>
            <h3 class="text-lg font-bold text-foreground mb-2">LocalStorage</h3>
            <p class="text-muted-foreground text-sm font-medium leading-relaxed">Browser-persistent key-value store. Efficient for lightweight settings but with strict capacity constraints.</p>
        </div>
    </div>

    @if (isUpdating)
    {
        <div class="mt-12 bg-primary/5 p-8 rounded-lg border border-primary/10 flex items-center justify-center gap-4 animate-pulse">
            <div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
            <span class="text-[10px] font-bold text-primary uppercase tracking-widest">Reinitializing Database Fabric...</span>
        </div>
    }
</div>

@code {
    private bool isUpdating = false;

    private async Task ChangeStorage(StorageType type)
    {
        if (StorageService.CurrentType == type) return;

        isUpdating = true;
        StateHasChanged();
        
        await Task.Delay(600);
        StorageService.SetStorageType(type);
        
        nav.NavigateTo(nav.Uri, forceLoad: true);
    }
}
