@page "/settings/db-provider"

<div class="max-w-4xl mx-auto space-y-8 animate-fade-in pb-10">
    <div class="mb-6">
        <h2 class="text-2xl font-semibold text-slate-900 tracking-tight">Storage Settings</h2>
        <p class="text-sm text-slate-500 mt-1">Select your preferred database provider for local data persistence.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- IndexedDB -->
        <div class="bg-white rounded-xl border-2 transition-all cursor-pointer p-6 shadow-sm @(StorageService.CurrentType == StorageType.IndexedDb ? "border-indigo-500 ring-2 ring-indigo-50" : "border-slate-200 hover:border-indigo-300 hover:shadow-md")"
             @onclick="() => ChangeStorage(StorageType.IndexedDb)">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3zM4 11h16M4 15h16" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.IndexedDb)
                {
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-indigo-100 text-indigo-700">Active</span>
                }
            </div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">IndexedDB</h3>
            <p class="text-slate-500 text-sm leading-relaxed">Recommended for larger datasets. Persists data locally in the browser's database securely.</p>
        </div>

        <!-- Session Storage -->
        <div class="bg-white rounded-xl border-2 transition-all cursor-pointer p-6 shadow-sm @(StorageService.CurrentType == StorageType.SessionStorage ? "border-indigo-500 ring-2 ring-indigo-50" : "border-slate-200 hover:border-indigo-300 hover:shadow-md")"
             @onclick="() => ChangeStorage(StorageType.SessionStorage)">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-slate-100 text-slate-600 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.SessionStorage)
                {
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-indigo-100 text-indigo-700">Active</span>
                }
            </div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">Session Storage</h3>
            <p class="text-slate-500 text-sm leading-relaxed">Temporary storage that lasts only until the browser tab is closed. Ideal for quick demos.</p>
        </div>

        <!-- Local Storage -->
        <div class="bg-white rounded-xl border-2 transition-all cursor-pointer p-6 shadow-sm @(StorageService.CurrentType == StorageType.LocalStorage ? "border-indigo-500 ring-2 ring-indigo-50" : "border-slate-200 hover:border-indigo-300 hover:shadow-md")"
             @onclick="() => ChangeStorage(StorageType.LocalStorage)">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-slate-100 text-slate-600 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.LocalStorage)
                {
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-semibold bg-indigo-100 text-indigo-700">Active</span>
                }
            </div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">Local Storage</h3>
            <p class="text-slate-500 text-sm leading-relaxed">Browser-level persistence. Easy to use but has a smaller capacity limit (5-10MB).</p>
        </div>
    </div>

    @if (isUpdating)
    {
        <div class="mt-8 bg-indigo-50 p-4 rounded-xl border border-indigo-100 flex items-center space-x-3 text-indigo-700 font-medium text-sm animate-pulse">
            <svg class="w-5 h-5 animate-spin text-indigo-600" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path></svg>
            <span>Applying changes and reinitializing database...</span>
        </div>
    }
</div>

@code {
    private bool isUpdating = false;

    private async Task ChangeStorage(StorageType type)
    {
        if (StorageService.CurrentType == type) return;

        isUpdating = true;
        StateHasChanged();
        
        await Task.Delay(600);
        StorageService.SetStorageType(type);
        
        nav.NavigateTo(nav.Uri, forceLoad: true);
    }
}
