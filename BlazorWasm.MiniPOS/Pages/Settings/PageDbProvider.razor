@page "/settings/db-provider"

<div class="max-w-[1200px] mx-auto space-y-8 animate-fade-in pb-12">
    <div class="mb-10">
        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Core Storage</h2>
        <p class="text-sm text-slate-500 mt-2 font-medium">Configure primary data persistence engine for local operations.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- IndexedDB -->
        <div class="glass-card bg-white p-8 transition-all cursor-pointer border-2 @(StorageService.CurrentType == StorageType.IndexedDb ? "border-orange-500 shadow-xl shadow-orange-500/10 ring-4 ring-orange-500/5" : "border-transparent hover:border-orange-200")"
             @onclick="() => ChangeStorage(StorageType.IndexedDb)">
            <div class="flex items-center justify-between mb-8">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center transition-all @(StorageService.CurrentType == StorageType.IndexedDb ? "orange-gradient text-white shadow-lg shadow-orange-500/20" : "bg-orange-50 text-orange-500")">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7c-2 0-3 1-3 3zM4 11h16M4 15h16" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.IndexedDb)
                {
                    <span class="inline-flex items-center px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-orange-100 text-orange-600 border border-orange-200/50">Active Engine</span>
                }
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-3">IndexedDB</h3>
            <p class="text-slate-500 text-sm font-medium leading-relaxed">Industrial-grade local storage. Optimized for high-volume datasets and structured transaction logging.</p>
        </div>

        <!-- Session Storage -->
        <div class="glass-card bg-white p-8 transition-all cursor-pointer border-2 @(StorageService.CurrentType == StorageType.SessionStorage ? "border-orange-500 shadow-xl shadow-orange-500/10 ring-4 ring-orange-500/5" : "border-transparent hover:border-orange-200")"
             @onclick="() => ChangeStorage(StorageType.SessionStorage)">
            <div class="flex items-center justify-between mb-8">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center transition-all @(StorageService.CurrentType == StorageType.SessionStorage ? "orange-gradient text-white shadow-lg shadow-orange-500/20" : "bg-orange-50 text-orange-500")">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.SessionStorage)
                {
                    <span class="inline-flex items-center px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-orange-100 text-orange-600 border border-orange-200/50">Active Engine</span>
                }
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-3">Volatile Memory</h3>
            <p class="text-slate-500 text-sm font-medium leading-relaxed">Temporary operational state. Data is cleared instantly upon session termination or tab closure.</p>
        </div>

        <!-- Local Storage -->
        <div class="glass-card bg-white p-8 transition-all cursor-pointer border-2 @(StorageService.CurrentType == StorageType.LocalStorage ? "border-orange-500 shadow-xl shadow-orange-500/10 ring-4 ring-orange-500/5" : "border-transparent hover:border-orange-200")"
             @onclick="() => ChangeStorage(StorageType.LocalStorage)">
            <div class="flex items-center justify-between mb-8">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center transition-all @(StorageService.CurrentType == StorageType.LocalStorage ? "orange-gradient text-white shadow-lg shadow-orange-500/20" : "bg-orange-50 text-orange-500")">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                    </svg>
                </div>
                @if (StorageService.CurrentType == StorageType.LocalStorage)
                {
                    <span class="inline-flex items-center px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-orange-100 text-orange-600 border border-orange-200/50">Active Engine</span>
                }
            </div>
            <h3 class="text-xl font-bold text-slate-900 mb-3">LocalStorage</h3>
            <p class="text-slate-500 text-sm font-medium leading-relaxed">Browser-persistent key-value store. Efficient for lightweight settings but with strict capacity constraints.</p>
        </div>
    </div>

    @if (isUpdating)
    {
        <div class="mt-12 bg-orange-50 p-8 rounded-[2rem] border border-orange-100 flex items-center justify-center space-x-4 animate-pulse">
            <div class="w-5 h-5 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
            <span class="text-sm font-black text-orange-600 uppercase tracking-widest">Reinitializing Database Fabric...</span>
        </div>
    }
</div>

@code {
    private bool isUpdating = false;

    private async Task ChangeStorage(StorageType type)
    {
        if (StorageService.CurrentType == type) return;

        isUpdating = true;
        StateHasChanged();
        
        await Task.Delay(600);
        StorageService.SetStorageType(type);
        
        nav.NavigateTo(nav.Uri, forceLoad: true);
    }
}
